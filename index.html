<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Tracker</title>
    <link rel="stylesheet" href="style.css">
    <!-- SortableJS for drag-and-drop functionality -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <!-- Chart.js for progress visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="is-guest"> <!-- Start in guest mode -->
    <div id="app-container">
        <header class="header">
            <div class="header-top-right">
                <!-- Language Selector -->
                <div class="language-selector">
                    <img src="https://flagcdn.com/fr.svg" alt="Fran√ßais" id="lang-fr" class="flag">
                    <img src="https://flagcdn.com/us.svg" alt="English" id="lang-en" class="flag active">
                </div>
                <!-- Authentication -->
                <div id="auth-container">
                     <div id="login-area">
                        <div id="login-form">
                            <input type="email" id="login-email" data-translate-key="loginEmailPlaceholder" placeholder="Email" required>
                            <input type="password" id="login-password" data-translate-key="loginPasswordPlaceholder" placeholder="Password" required>
                        </div>
                        <button id="login-btn" data-translate-key="loginBtn">Login</button>
                    </div>
                    <div id="logout-area" class="hidden">
                        <span id="auth-status"></span>
                        <button id="logout-btn" data-translate-key="logoutBtn">Logout</button>
                    </div>
                </div>
            </div>

            <!-- Calendar Component -->
            <div id="simple-calendar-container">
                <div id="calendar-picker" class="simple-calendar-picker">
                    <select id="month-select"></select>
                    <select id="year-select"></select>
                    <button id="picker-go-btn">OK</button>
                </div>
            </div>

            <h1 data-translate-key="mainTitle">Fitness Tracker üèãÔ∏è‚Äç‚ôÇÔ∏è</h1>
            <p data-translate-key="subTitle">Select a date to view or add a workout.</p>

            <!-- Date Navigation -->
            <div class="date-navigation">
                <button id="prev-day-btn" class="day-nav-btn" aria-label="Previous day">‚Äπ</button>
                <input type="date" id="date-picker" aria-label="Date selector">
                <button id="next-day-btn" class="day-nav-btn" aria-label="Next day">‚Ä∫</button>
            </div>
        </header>

        <main class="main-container">
            <!-- Exercise Form -->
            <div class="form-container">
                <h2 data-translate-key="addExerciseTitle" id="form-title">Add Exercise</h2>
                <form id="add-workout-form">
                    <div class="form-group search-container">
                        <label for="exercise-search" data-translate-key="exerciseSearchLabel">Search Exercise</label>
                        <input type="text" id="exercise-search" placeholder="e.g., Bench Press" autocomplete="off">
                        <div id="autocomplete-results"></div>
                    </div>
                    <div class="form-group"><label for="category-select" data-translate-key="categoryLabel">Category</label><select id="category-select" required></select></div>
                    <div class="form-group"><label for="exercise-select" data-translate-key="exerciseLabel">Exercise</label><select id="exercise-select" required></select></div>

                    <!-- Quick Add Sets Section -->
                    <div id="quick-add-container">
                        <div class="quick-add-group"><label for="quick-sets" data-translate-key="setsLabel">Sets</label><input type="number" id="quick-sets" min="1" value="3"></div>
                        <div class="quick-add-group"><label for="quick-reps" data-translate-key="repsLabel">Repetitions</label><input type="number" id="quick-reps" min="1"></div>
                        <div class="quick-add-group"><label for="quick-weight" data-translate-key="weightLabel">Weight</label><input type="number" id="quick-weight" min="0" step="0.5"></div>
                        <div class="quick-add-group"><label for="quick-unit" data-translate-key="unitLabel">Unit</label><select id="quick-unit"><option value="lbs" selected>lbs</option><option value="kg">kg</option></select></div>
                        <div class="quick-add-group bodyweight-group"><input type="checkbox" id="bodyweight-checkbox"><label for="bodyweight-checkbox" data-translate-key="bodyweightLabel">Bodyweight</label></div>
                        <button type="button" id="generate-sets-button" data-translate-key="generateSetsBtn">Generate Sets</button>
                    </div>

                    <div id="sets-container"></div>
                    <button type="button" id="add-set-button" data-translate-key="addSetManuallyBtn">Add Set Manually</button>

                    <div class="form-group"><label for="notes-input" data-translate-key="notesLabel">Notes</label><textarea id="notes-input" data-translate-key="notesPlaceholder" placeholder="How it felt, performance..."></textarea></div>
                    <div class="form-actions"><button type="submit" class="submit-btn" id="submit-workout-btn" data-translate-key="saveExerciseBtn">Save</button><button type="button" class="cancel-btn" id="cancel-edit-btn" data-translate-key="cancelEditBtn">Cancel</button></div>
                </form>
            </div>

            <!-- Workout Log Display -->
            <div id="workout-log-container">
                <div class="workout-log-header">
                    <h2 data-translate-key="workoutOf">Workout for <span id="log-date"></span></h2>
                    <div class="header-actions">
                        <button id="import-workout-btn" class="import-btn" data-translate-key="importBtn" title="Import from another day">Import</button>
                        <div class="display-unit-selector">
                            <button id="display-kg" class="unit-toggle">kg</button>
                            <button id="display-lbs" class="unit-toggle active">lbs</button>
                        </div>
                    </div>
                </div>
                <div id="workout-log"></div>
            </div>
        </main>
    </div>

    <!-- HTML template for a single set row in the form -->
    <template id="set-row-template">
        <div class="set-row">
            <input type="number" class="reps-input" placeholder="Reps" min="0" required>
            <span>x</span>
            <input type="number" class="weight-input" placeholder="Weight" min="0" step="0.5" required>
            <select class="unit-select"><option value="lbs" selected>lbs</option><option value="kg">kg</option></select>
            <button type="button" class="delete-set-btn" aria-label="Delete set">-</button>
        </div>
    </template>

    <!-- Tooltip for the calendar -->
    <div id="calendar-tooltip" class="calendar-tooltip"></div>

    <!-- Import Modal -->
    <div id="import-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 data-translate-key="importModalTitle">Import Workout</h3>
            <p data-translate-key="importModalDesc">Select a date to copy the workout from.</p>
            <input type="date" id="import-date-picker">
            <div class="modal-actions">
                <button id="import-cancel-btn" class="cancel-btn" data-translate-key="cancelBtn">Cancel</button>
                <button id="import-confirm-btn" class="submit-btn" data-translate-key="importBtn">Import</button>
            </div>
        </div>
    </div>

    <!-- Progress Chart Modal -->
    <div id="progress-modal" class="modal-overlay hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="progress-modal-title">Progress: Exercise Name</h3>
                <button id="progress-modal-close" class="modal-close-btn" aria-label="Close modal">&times;</button>
            </div>
            <div id="progress-chart-controls">
                <button class="metric-btn active" data-metric="maxWeight">Max Weight</button>
                <button class="metric-btn" data-metric="totalVolume">Total Volume</button>
                <button class="metric-btn" data-metric="est1RM">Best Set (Est. 1RM)</button>
            </div>
            <div class="chart-container">
                <canvas id="progress-chart-canvas"></canvas>
            </div>
            <div class="history-table-container">
                <h4>Recent History</h4>
                <table id="progress-history-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Top Set</th>
                            <th>Total Volume</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be populated dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Main application script -->
    <script src="script.js" type="module"></script>
</body>
</html>
